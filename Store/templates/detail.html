<!DOCTYPE html>
<html lang="en">
{% load static %}
{% load youtube_filters %}
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/png" href="{% static 'Images/circle.png' %}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ product.name }} | Shopping Cart</title>
  <meta name="description" content="{{ product.meta_description|default:product.short_description }}">
  <meta name="keywords" content="{{ product.meta_keywords|default:product.name }}">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/easyzoom/2.5.2/easyzoom.min.css">
  <link rel="stylesheet" href="{% static 'style.css' %}">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
  />
  <style>
    :root {
      --primary-dark: #0f172a;
      --primary-blue: #3b82f6;
      --secondary-blue: #2563eb;
      --accent-yellow: #fbbf24;
      --text-dark: #1e293b;
      --text-gray: #64748b;
      --bg-light: #f8fafc;
      --glass-bg: rgba(255, 255, 255, 0.65);
      --glass-border: rgba(255, 255, 255, 0.4);
      --gradient-hero: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top right, #f1f5f9, #e2e8f0);
      color: var(--text-dark);
      overflow-x: hidden;
      min-height: 100vh;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Outfit', sans-serif;
    }

    /* Premium Breadcrumb Header */
    .detail-breadcrumb-nav {
        background: rgba(248, 250, 252, 0.4);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 15px 0;
        border-bottom: 1px solid var(--glass-border);
    }

    .breadcrumb-item a {
        color: var(--text-gray);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
    }

    .breadcrumb-item a:hover {
        color: var(--primary-blue);
    }

    .breadcrumb-item.active {
        color: var(--primary-dark);
        font-weight: 600;
    }

    /* Product Showcase Base */
    .product-main-container {
        padding: 40px 0;
    }

    /* Gallery Styling */
    .gallery-container {
        display: flex;
        gap: 20px;
    }

    .gallery-thumbs {
        width: 80px;
        flex-shrink: 0;
    }

    .gallery-thumbs .swiper-slide {
        cursor: pointer;
        opacity: 0.6;
        transition: all 0.3s;
        border-radius: 12px;
        overflow: hidden;
        border: 2px solid transparent;
        height: 80px !important;
        background: var(--glass-bg);
        backdrop-filter: blur(4px);
    }

    .gallery-thumbs .swiper-slide-thumb-active {
        opacity: 1;
        border-color: var(--primary-blue);
        box-shadow: var(--shadow-sm);
        transform: scale(1.05);
    }

    .gallery-thumbs .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        padding: 5px;
    }

    .gallery-top {
        flex-grow: 1;
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border-radius: 24px;
        overflow: hidden;
        position: relative;
        height: 550px;
        border: 1px solid var(--glass-border);
        box-shadow: var(--shadow-md);
    }

    .gallery-top .swiper-slide {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px;
        transition: transform 0.5s ease;
    }

    .gallery-top .swiper-slide img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        filter: drop-shadow(0 10px 20px rgba(0,0,0,0.08));
    }

    /* Sidebar Actions */
    .product-info-column {
        padding-left: 30px;
    }

    .sku-badge {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        color: var(--text-gray);
        font-weight: 700;
        margin-bottom: 12px;
        display: inline-block;
        padding: 4px 12px;
        background: rgba(0,0,0,0.05);
        border-radius: 50px;
    }

    .product-name {
        font-size: 2.25rem;
        font-weight: 800;
        color: var(--primary-dark);
        margin-bottom: 1rem;
        line-height: 1.2;
        letter-spacing: -0.02em;
    }

    .price-container {
        margin: 1.5rem 0;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .current-price {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--primary-blue);
        font-family: 'Outfit', sans-serif;
    }

    .old-price {
        font-size: 1.4rem;
        color: var(--text-gray);
        text-decoration: line-through;
        opacity: 0.7;
    }

    .discount-badge {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        padding: 6px 16px;
        border-radius: 50px;
        font-weight: 700;
        font-size: 0.9rem;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
    }

    /* Variant Chips */
    .variant-section {
        margin: 2rem 0;
    }

    .variant-label {
        font-weight: 700;
        margin-bottom: 15px;
        display: block;
        color: var(--primary-dark);
    }

    .variant-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
    }

    .color-option {
        width: 65px;
        height: 65px;
        border-radius: 16px;
        cursor: pointer;
        border: 2px solid var(--glass-border);
        padding: 6px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        object-fit: contain;
        background: white;
        box-shadow: var(--shadow-sm);
    }

    .color-option.active {
        border-color: var(--primary-blue);
        transform: scale(1.15) rotate(3deg);
        box-shadow: var(--shadow-md);
    }

    /* Quantity Input */
    .qty-selector {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(5px);
        border: 1px solid var(--glass-border);
        border-radius: 50px;
        padding: 6px;
        width: fit-content;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
    }

    .qty-btn {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        border: none;
        background: white;
        color: var(--primary-dark);
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
        box-shadow: var(--shadow-sm);
    }

    .qty-btn:hover {
        background: var(--primary-blue);
        color: white;
        transform: scale(1.1);
    }

    .qty-input {
        width: 55px;
        border: none;
        background: transparent;
        text-align: center;
        font-weight: 800;
        font-size: 1.2rem;
        color: var(--primary-dark);
    }

    /* Action Buttons - User said "perfect", so keeping colors but adding polish */
    .btn-premium {
        padding: 16px 24px;
        border-radius: 18px;
        font-weight: 800;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        border: none;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .btn-buy {
        background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
        color: white;
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
    }

    .btn-buy:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
        filter: brightness(1.1);
    }

    .btn-whatsapp {
        background: linear-gradient(135deg, #25d366, #128c7e);
        color: white;
        box-shadow: 0 10px 25px rgba(37, 211, 102, 0.3);
    }

    .btn-whatsapp:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(37, 211, 102, 0.4);
        filter: brightness(1.1);
    }

    .btn-secondary-action {
        background: var(--glass-bg);
        backdrop-filter: blur(8px);
        color: var(--primary-dark);
        padding: 14px;
        border-radius: 16px;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: all 0.3s;
        border: 1px solid var(--glass-border);
        box-shadow: var(--shadow-sm);
    }

    .btn-secondary-action:hover {
        background: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .btn-secondary-action.liked {
        color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.3);
    }

    /* Fixed Bottom Nav (Mobile) */
    #end {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(15px);
        padding: 15px 20px;
        box-shadow: 0 -10px 30px rgba(0,0,0,0.1);
        z-index: 1000;
        border-top: 1px solid var(--glass-border);
    }

    /* Description & Specs */
    .info-tabs {
        margin-top: 5rem;
        padding-top: 3rem;
    }

    .tab-section-title {
        font-weight: 800;
        font-size: 1.75rem;
        margin-bottom: 2rem;
        position: relative;
        padding-bottom: 15px;
        color: var(--primary-dark);
    }

    .tab-section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 5px;
        background: linear-gradient(to right, var(--primary-blue), var(--secondary-blue));
        border-radius: 10px;
    }

    /* Premium Tabs Styling */
    .custom-tabs {
        border: none;
        gap: 40px;
        margin-bottom: 40px;
        justify-content: center;
    }

    .custom-tabs .nav-link {
        border: none;
        padding: 15px 25px;
        color: var(--text-gray);
        font-weight: 700;
        font-size: 1.15rem;
        border-radius: 15px;
        position: relative;
        transition: all 0.4s;
        background: transparent;
        font-family: 'Outfit', sans-serif;
    }

    .custom-tabs .nav-link:hover {
        color: var(--primary-blue);
        background: rgba(59, 130, 246, 0.05);
    }

    .custom-tabs .nav-link.active {
        color: white;
        background: var(--primary-dark) !important;
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.2);
    }

    /* Specifications */
    .spec-item {
        background: var(--glass-bg);
        backdrop-filter: blur(8px);
        padding: 20px 25px;
        border-radius: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid var(--glass-border);
        height: 100%;
        transition: all 0.3s ease;
    }

    .spec-item:hover {
        background: white;
        transform: scale(1.02);
        box-shadow: var(--shadow-sm);
    }

    .spec-label {
        color: var(--text-muted);
        font-weight: 600;
        font-size: 0.95rem;
    }

    .spec-value {
        font-weight: 700;
        color: var(--primary-dark);
    }

    /* Reviews Styling */
    .reviews-section {
        background: rgba(241, 245, 249, 0.5);
        padding: 5rem 0;
        margin-top: 5rem;
        border-top: 1px solid var(--glass-border);
    }

    .review-summary-card {
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        padding: 40px 30px;
        border-radius: 30px;
        box-shadow: var(--shadow-md);
        text-align: center;
        border: 1px solid var(--glass-border);
    }

    .avg-rating-val {
        font-size: 4.5rem;
        font-weight: 800;
        color: var(--primary-dark);
        line-height: 1;
        margin-bottom: 15px;
        font-family: 'Outfit', sans-serif;
    }

    .review-card {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        padding: 30px;
        border-radius: 24px;
        margin-bottom: 25px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--glass-border);
        transition: all 0.3s ease;
    }

    .review-card:hover {
        background: white;
        transform: translateY(-5px);
        box-shadow: var(--shadow-md);
    }

    /* Notification */
    .notification {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        color: var(--primary-dark);
        padding: 20px 30px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--glass-border);
        font-weight: 700;
        transform: translateY(150%) scale(0.9);
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 10001;
        pointer-events: none; /* Crucial: don't block clicks when hidden */
    }

    .notification.show {
        transform: translateY(0) scale(1);
        pointer-events: auto;
    }

    @media (max-width: 768px) {
        .notification {
            top: 20px;
            bottom: auto;
            left: 20px;
            right: 20px;
            transform: translateY(-150%) scale(0.9);
            padding: 15px 20px;
            font-size: 0.9rem;
        }
        .notification.show {
            transform: translateY(0) scale(1);
        }
    }

    /* Modal Styling */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        display: none;
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
    }

    .modal-content {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 30px;
        border: 1px solid var(--glass-border);
        box-shadow: var(--shadow-lg);
    }

    .share-modal-content {
        max-width: 480px;
        width: 95%;
        margin: auto;
    }

    /* Review/Auth Modal Specifics */
    .review-modal-content, .auth-modal-content {
        max-width: 500px;
        width: 95%;
        margin: auto;
        overflow: hidden;
        animation: modalEntrance 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes modalEntrance {
        from { opacity: 0; transform: translateY(30px) scale(0.95); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .auth-modal-content .modal-header {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        position: relative;
        color: white;
        padding: 40px 30px;
        border: none;
        overflow: hidden;
    }

    .auth-modal-content .modal-header::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle at center, rgba(59, 130, 246, 0.15) 0%, transparent 70%);
        animation: rotateGlow 10s linear infinite;
    }

    @keyframes rotateGlow {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .auth-modal-content .btn-close {
        filter: invert(1) brightness(2);
    }

    .auth-modal-content .modal-body {
        padding: 40px !important;
    }

    .share-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    @media (min-width: 768px) {
        .share-grid .share-option {
            padding: 30px 20px !important;
            font-size: 1.1rem;
            border-radius: 20px !important;
        }
        .share-grid .share-option i {
            font-size: 2rem !important;
            margin-bottom: 15px !important;
        }
    }

    .rating-input {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;
        gap: 5px;
    }

    .rating-input input {
        display: none;
    }

    .rating-input label {
        cursor: pointer;
        font-size: 2.5rem;
        color: #e2e8f0;
        transition: all 0.2s ease;
    }

    .rating-input input:checked ~ label,
    .rating-input label:hover,
    .rating-input label:hover ~ label {
        color: #fbbf24;
        text-shadow: 0 0 10px rgba(251, 191, 36, 0.4);
    }

    .rating-input label:active {
        transform: scale(0.9);
    }

    /* Auth Form Elements */
    .auth-form-control {
        background: rgba(248, 250, 252, 0.6);
        backdrop-filter: blur(5px);
        border: 2px solid rgba(226, 232, 240, 0.8);
        border-radius: 18px;
        padding: 16px 22px;
        font-weight: 500;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        color: var(--primary-dark);
    }

    .auth-form-control:focus {
        background: white;
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 6px rgba(59, 130, 246, 0.12);
        transform: translateY(-2px);
    }

    .btn-auth-submit {
        background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
        color: white;
        border: none;
        padding: 18px;
        border-radius: 18px;
        font-weight: 700;
        font-size: 1.05rem;
        letter-spacing: 0.5px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.2);
        position: relative;
        overflow: hidden;
    }

    .btn-auth-submit::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        transition: 0.5s;
    }

    .btn-auth-submit:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 20px 40px rgba(15, 23, 42, 0.3);
    }

    .btn-auth-submit:hover::after {
        left: 100%;
    }

    .auth-transition-container {
        transition: all 0.5s ease;
        animation: fadeInSlide 0.5s ease-out;
    }

    @keyframes fadeInSlide {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
    }

    /* Responsive */
    @media (max-width: 992px) {
        .gallery-container { flex-direction: column; }
        .gallery-thumbs { width: 100%; order: 2; margin-top: 15px; }
        .gallery-thumbs .swiper-wrapper { display: flex; flex-direction: row; }
        .gallery-thumbs .swiper-slide { width: 80px !important; }
        .gallery-top { order: 1; height: 450px; border-radius: 20px; }
        .product-info-column { padding-left: 0; margin-top: 40px; }
        .product-name { font-size: 1.8rem; }
        .current-price { font-size: 2rem; }
    }

    @media (max-width: 576px) {
        .gallery-top { height: 350px; }
        .action-buttons { grid-template-columns: 1fr; }
        .custom-tabs { gap: 15px; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 10px; justify-content: flex-start; }
        .custom-tabs .nav-link { font-size: 1rem; padding: 10px 15px; white-space: nowrap; }
    }
  </style>
  </style>
</head>
<body>
  {% include 'Includes/navbar.html' %}
  
  <!-- Notification div -->
  <div id="notification" class="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notification-message"></span>
  </div>

  <!-- Share Modal -->
  <div id="shareModal" class="modal">
    <div class="modal-content share-modal-content border-0">
      <div class="modal-header border-0 pb-0">
          <h4 class="fw-800 mb-0">Share Now</h4>
          <span class="close-share fs-3" style="cursor:pointer;">&times;</span>
      </div>
      <div class="modal-body">
        <p class="text-gray mb-4">Select a platform to share this product with your friends.</p>
        <div class="share-grid">
            <button class="share-option btn-secondary-action w-100 border-0 py-3" data-type="facebook" style="background:#e7f3ff; color:#1877f2;">
                <i class="fab fa-facebook fs-4 mb-1 d-block"></i>Facebook
            </button>
            <button class="share-option btn-secondary-action w-100 border-0 py-3" data-type="twitter" style="background:#f0f7ff; color:#1da1f2;">
                <i class="fab fa-twitter fs-4 mb-1 d-block"></i>Twitter
            </button>
            <button class="share-option btn-secondary-action w-100 border-0 py-3" data-type="whatsapp" style="background:#e7fbf0; color:#25d366;">
                <i class="fab fa-whatsapp fs-4 mb-1 d-block"></i>WhatsApp
            </button>
            <button class="share-option btn-secondary-action w-100 border-0 py-3" data-type="link" style="background:#f1f5f9; color:var(--primary-dark);">
                <i class="fas fa-link fs-4 mb-1 d-block"></i>Copy Link
            </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Review Modal -->
  <div id="reviewModal" class="modal">
    <div class="modal-content review-modal-content border-0">
      <div class="modal-header border-0 pb-0 pt-4 px-4">
          <h3 class="fw-800 mb-0">Share Your Experience</h3>
          <span class="close-review fs-3" style="cursor:pointer;">&times;</span>
      </div>
      <div class="modal-body p-4">
        <p class="text-gray mb-4">Your feedback helps others make better choices. Thank you for sharing!</p>
        <form id="reviewForm" method="post" action="{% url 'submit_review' product.id %}">
            {% csrf_token %}
            <div class="mb-4 d-flex align-items-center gap-3 p-3 rounded-4 bg-light">
                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                    <i class="fas fa-user-check"></i>
                </div>
                <div>
                    <span class="text-muted d-block small">Reviewing as</span>
                    <span class="fw-700 text-primary">{{ request.user.username }}</span>
                </div>
                <input type="hidden" name="reviewer_name" value="{{ request.user.get_full_name|default:request.user.username }}">
            </div>
            <div class="mb-4">
                <label class="form-label fw-600">Select Rating</label>
                <div class="rating-input">
                    <input type="radio" id="star5_modal" name="rating" value="5" required/>
                    <label for="star5_modal">★</label>
                    <input type="radio" id="star4_modal" name="rating" value="4" required/>
                    <label for="star4_modal">★</label>
                    <input type="radio" id="star3_modal" name="rating" value="3" required/>
                    <label for="star3_modal">★</label>
                    <input type="radio" id="star2_modal" name="rating" value="2" required/>
                    <label for="star2_modal">★</label>
                    <input type="radio" id="star1_modal" name="rating" value="1" required/>
                    <label for="star1_modal">★</label>
                </div>
            </div>
            <div class="mb-4">
                <label class="form-label fw-600">Detail Review</label>
                <textarea class="form-control rounded-4 bg-light border-0 p-4" name="review" rows="4" placeholder="What did you like or dislike about this product?" required></textarea>
            </div>
            <button type="submit" class="btn-premium btn-buy w-100 py-3 rounded-4 shadow-lg mt-2">
                Post Review <i class="fas fa-paper-plane ms-2"></i>
            </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Breadcrumb -->
  <nav class="detail-breadcrumb-nav" aria-label="breadcrumb">
    <div class="container">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
        <li class="breadcrumb-item">
            {% if is_project %}
              <a href="{% url 'project' %}">Projects</a>
            {% else %}
              <a href="{% url 'product' %}">Products</a>
            {% endif %}
        </li>
        <li class="breadcrumb-item active">{{ product.name }}</li>
      </ol>
    </div>
  </nav>

  <!-- Product Showcase -->
  <main class="product-main-container">
    <div class="container">
      <div class="row">
        <!-- Gallery Column -->
        <div class="col-lg-7">
          <div class="gallery-container">
            <!-- Thumbs -->
            <div class="swiper gallery-thumbs d-none d-md-block">
              <div class="swiper-wrapper">
                <div class="swiper-slide"><img src="{{ product.main_image.url }}" alt="{{ product.get_alt_text }}"></div>
                {% for image in product.images.all %}
                <div class="swiper-slide"><img src="{{ image.image.url }}" alt="{{ image.get_alt_text }}"></div>
                {% endfor %}
                {% for variant in product.variants.all %}
                <div class="swiper-slide"><img src="{{ variant.image.url }}" alt="{{ variant.get_alt_text }}"></div>
                {% endfor %}
              </div>
            </div>
            <!-- Main Gallery -->
            <div class="swiper gallery-top">
              <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <div class="easyzoom easyzoom--overlay">
                        <a href="{{ product.main_image.url }}">
                            <img src="{{ product.main_image.url }}" alt="{{ product.get_alt_text }}" data-price="{{ product.price }}">
                        </a>
                    </div>
                </div>
                {% for image in product.images.all %}
                <div class="swiper-slide"><img src="{{ image.image.url }}" alt="{{ image.get_alt_text }}"></div>
                {% endfor %}
                {% for variant in product.variants.all %}
                <div class="swiper-slide"><img src="{{ variant.image.url }}" alt="{{ variant.get_alt_text }}" data-price="{{ variant.price }}"></div>
                {% endfor %}
                {% if product.youtube_video_url %}
                  <div class="swiper-slide">
                    <div class="ratio ratio-16x9 w-100">
                      <iframe src="{{ product.youtube_video_url|youtube_embed_url }}" allowfullscreen></iframe>
                    </div>
                  </div>
                {% endif %}
              </div>
              <div class="swiper-button-next"></div>
              <div class="swiper-button-prev"></div>
            </div>
          </div>
        </div>

        <!-- Info Column -->
        <div class="col-lg-5 product-info-column">
          <span class="sku-badge">SKU: {{ product.sku }}</span>
          <h1 class="product-name">{{ product.name }}</h1>
          
          <p class="text-gray mb-4">{{ product.short_description }}</p>

          <div class="price-container">
            {% if product.discount_percentage > 0 %}
              <span class="current-price" id="priceDisplay">Rs {{ product.final_price }}</span>
              <span class="old-price">Rs {{ product.price }}</span>
              <span class="discount-badge">-{{ product.discount_percentage }}% OFF</span>
            {% else %}
              <span class="current-price" id="priceDisplay">Rs {{ product.price }}</span>
            {% endif %}
          </div>

          <hr class="my-4 opacity-10">

          {% if product.variants.all %}
          <div class="variant-section">
            <span class="variant-label">Select Variant:</span>
            <div class="variant-grid">
              {% for variant in product.variants.all %}
              <img src="{{ variant.image.url }}" alt="{{ variant.get_alt_text }}" class="color-option {% if forloop.first %}active{% endif %}" data-slide-index="{{ forloop.counter|add:product.images.count }}" data-price="{{ variant.price }}" data-variant-id="{{ variant.id }}">
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <div class="d-flex align-items-center gap-4 mb-4">
            <div class="qty-selector">
              <button class="qty-btn" onclick="updateQuantity(-1, 'quantity')"><i class="bi bi-dash"></i></button>
              <input type="text" id="quantity" class="qty-input" value="1" readonly>
              <button class="qty-btn" onclick="updateQuantity(1, 'quantity')"><i class="bi bi-plus"></i></button>
            </div>
            
            {% if product.stock %}
                <span class="badge bg-soft-success text-success px-3 py-2 border border-success-subtle rounded-pill">
                    <i class="bi bi-check-circle-fill me-2"></i>{{ product.stock }} In Stock
                </span>
            {% else %}
                <span class="badge bg-soft-danger text-danger px-3 py-2 border border-danger-subtle rounded-pill">
                    <i class="bi bi-x-circle-fill me-2"></i>Out of Stock
                </span>
            {% endif %}
          </div>

          <div class="action-buttons">
            {% if request.user.is_authenticated %}
              <button class="btn-premium btn-buy add-to-cart" data-name="{{ product.name }}" data-price="{{ product.price }}" data-product-id="{{ product.id }}">
                <i class="fa-solid fa-cart-shopping"></i> Add to Cart
              </button>
              <button class="btn-premium btn-whatsapp order-whatsapp" data-name="{{ product.name }}" data-price="{{ product.price }}" data-product-id="{{ product.id }}">
                <i class="fab fa-whatsapp"></i> WhatsApp Order
              </button>
            {% else %}
              <button class="btn-premium btn-buy add-to-cart-unauth" data-name="{{ product.name }}" data-price="{{ product.price }}" data-product-id="{{ product.id }}">
                <i class="fa-solid fa-cart-shopping"></i> Add to Cart
              </button>
              <button class="btn-premium btn-whatsapp order-whatsapp-unauth" data-name="{{ product.name }}" data-price="{{ product.price }}" data-product-id="{{ product.id }}">
                <i class="fab fa-whatsapp"></i> WhatsApp Order
              </button>
            {% endif %}
          </div>

          <div class="d-flex gap-3">
            <button class="btn-secondary-action flex-grow-1 share-button" data-product-id="{{ product.id }}" data-slug="{{ product.slug }}">
              <i class="fa-solid fa-share-nodes"></i> Share
            </button>
            
            {% if request.user.is_authenticated %}
              <button class="btn-secondary-action flex-grow-1 like-button {% if is_liked %}liked{% endif %}" 
                      data-product-id="{{ product.id }}"
                      data-liked="{% if is_liked %}true{% else %}false{% endif %}">
                <i class="fa-solid fa-heart"></i>
                <span class="like-text">{% if is_liked %}Liked{% else %}Like{% endif %}</span>
                <span class="ms-1">({{ product.like_count }})</span>
              </button>
            {% else %}
              <button class="btn-secondary-action flex-grow-1 like-button-unauth" data-product-id="{{ product.id }}">
                <i class="fa-solid fa-heart"></i> Like ({{ product.like_count }})
              </button>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Tabs Section -->
      <div class="info-tabs">
        <ul class="nav nav-tabs custom-tabs" id="productTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="desc-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab" aria-controls="description" aria-selected="true">Description</button>
          </li>
          {% if product.features.all or product.specifications.all %}
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="spec-tab" data-bs-toggle="tab" data-bs-target="#specifications" type="button" role="tab" aria-controls="specifications" aria-selected="false">Technical Details</button>
          </li>
          {% endif %}
        </ul>
        
        <div class="tab-content" id="productTabContent">
          <!-- Description Tab -->
          <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="desc-tab">
            <div class="fs-5 text-gray lh-lg py-3" style="text-align:justify;">{{ product.description|linebreaks }}</div>
          </div>
          
          <!-- Specifications Tab -->
          {% if product.features.all or product.specifications.all %}
          <div class="tab-pane fade" id="specifications" role="tabpanel" aria-labelledby="spec-tab">
            <div class="py-4">
              <div class="row g-4">
                <!-- Features Column -->
                {% if product.features.all %}
                <div class="{% if product.specifications.all %}col-md-6{% else %}col-12{% endif %}">
                  <div class="row g-3">
                    <div class="col-12">
                        <div class="spec-item bg-primary text-white mb-2 align-center" style="border:none;">
                          <h4 class="fw-bold mb-0" style="font-family: 'Outfit', sans-serif;">Key Features</h4>
                          <i class="fas fa-microchip fs-4 opacity-50"></i>
                        </div>
                    </div>
                    {% for feature in product.features.all %}
                    <div class="col-12">
                        <div class="spec-item">
                          <span class="spec-label">{{ feature.title }}</span>
                          <span class="spec-value text-end fw-bold">{{ feature.feature }}</span>
                        </div>
                    </div>
                    {% endfor %}
                  </div>
                </div>
                {% endif %}
                
                <!-- Specifications Column -->
                {% if product.specifications.all %}
                <div class="{% if product.features.all %}col-md-6{% else %}col-12{% endif %}">
                  <div class="row g-3">
                    <div class="col-12">
                        <div class="spec-item bg-dark text-white mb-2 align-center" style="border:none;">
                          <h4 class="fw-bold mb-0" style="font-family: 'Outfit', sans-serif;">Specifications</h4>
                          <i class="fas fa-list-check fs-4 opacity-50"></i>
                        </div>
                    </div>
                    {% for spec in product.specifications.all %}
                    <div class="col-12">
                        <div class="spec-item">
                          <span class="spec-label">{{ spec.key }}</span>
                          <span class="spec-value text-end fw-bold">{{ spec.value }}</span>
                        </div>
                    </div>
                    {% endfor %}
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </main>

  <!-- Mobile Fixed Nav -->
  <div class="d-block d-md-none" id="end">
    <div class="d-flex gap-2">
      {% if request.user.is_authenticated %}
        <button class="btn-premium btn-buy flex-grow-1 py-3 add-to-cart" data-name="{{ product.name }}" data-price="{{ product.price }}" data-product-id="{{ product.id }}">
          <i class="fa-solid fa-cart-shopping"></i> Add
        </button>
        <button class="btn-premium btn-whatsapp flex-grow-1 py-3 order-whatsapp" data-name="{{ product.name }}" data-price="{{ product.price }}" data-product-id="{{ product.id }}">
          <i class="fab fa-whatsapp"></i> Order
        </button>
      {% else %}
        <button class="btn-premium btn-buy flex-grow-1 py-3 add-to-cart-unauth" data-name="{{ product.name }}" data-price="{{ product.price }}" data-product-id="{{ product.id }}">
          <i class="fa-solid fa-cart-shopping"></i> Add
        </button>
        <button class="btn-premium btn-whatsapp flex-grow-1 py-3 order-whatsapp-unauth" data-name="{{ product.name }}" data-price="{{ product.price }}" data-product-id="{{ product.id }}">
          <i class="fab fa-whatsapp"></i> Order
        </button>
      {% endif %}
    </div>
  </div>

  <!-- Customer Reviews -->
  <section class="reviews-section">
    <div class="container">
      <h2 class="tab-section-title text-center mb-5 mx-auto" style="width:fit-content;">Customer Reviews</h2>
      <div class="row g-4">
        <div class="col-lg-4">
          <div class="review-summary-card">
            <h4 class="text-gray mb-3">Average Rating</h4>
            <div class="avg-rating-val">{{ avg_rating }}</div>
            <div class="text-warning fs-3 mb-2">
              {% for _ in full_stars %}<i class="fas fa-star"></i>{% endfor %}
              {% if half_star %}<i class="fas fa-star-half-alt"></i>{% endif %}
              {% for _ in empty_stars %}<i class="far fa-star"></i>{% endfor %}
            </div>
            <p class="text-gray">Based on {{ reviews.count }} reviews</p>
            
            {% if request.user.is_authenticated %}
              <button class="btn-premium btn-buy w-100 mt-4 open-review-modal">
                  Write a Review
              </button>
            {% else %}
              <button class="btn-premium btn-buy w-100 mt-4" data-bs-toggle="modal" data-bs-target="#authModal">
                  Write a Review
              </button>
            {% endif %}
          </div>
        </div>
        
        <div class="col-lg-8">
          <div class="review-container pe-2">
            {% for review in reviews %}
              <div class="review-card">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <div>
                    <span class="review-author d-block">{{ review.reviewer_name }}</span>
                    <div class="text-warning small mt-1">
                      {% for _ in "12345" %}
                        {% if forloop.counter <= review.rating %}<i class="fas fa-star"></i>
                        {% elif review.rating|add:"0.5" >= forloop.counter %}<i class="fas fa-star-half-alt"></i>
                        {% else %}<i class="far fa-star"></i>{% endif %}
                      {% endfor %}
                    </div>
                  </div>
                  <span class="text-gray small">{{ review.created_at|date:"M d, Y" }}</span>
                </div>
                <p class="mb-0 text-gray lh-base">{{ review.review }}</p>
              </div>
            {% empty %}
              <div class="text-center py-5 bg-white rounded-4 border border-dashed">
                <i class="bi bi-chat-left-dots fs-1 text-gray mb-3 d-block"></i>
                <p class="text-gray">No reviews yet. Be the first to share your experience!</p>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

    </div>
  </section>

  </div>

  {% include 'Includes/footer.html' %}



 <!-- Login/Register Modal -->
<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content auth-modal-content border-0">
      
      <div class="modal-header d-flex flex-column align-items-center text-center">
        <div class="bg-white bg-opacity-10 rounded-circle p-3 mb-3">
            <i class="fas fa-user-lock fs-3"></i>
        </div>
        <h4 class="modal-title fw-800" id="authModalTitle">Welcome Back</h4>
        <p class="mb-0 opacity-75 small" id="authModalSubtitle">Please login to continue</p>
        <button type="button" class="btn-close position-absolute end-0 top-0 m-4" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <!-- Login Form -->
        <div id="loginFormContainer" class="auth-transition-container">
          <form id="loginForm" method="POST" action="{% url 'ajax_login' %}?next={{ request.path }}">
            {% csrf_token %}
            <div class="mb-4">
              <label for="username" class="form-label fw-700 text-primary-dark small ms-2 mb-2">Username</label>
              <div class="position-relative">
                <i class="fas fa-user position-absolute start-0 top-50 translate-middle-y ms-3 text-muted"></i>
                <input type="text" class="form-control auth-form-control ps-5" id="username" name="username" placeholder="Enter username" required>
              </div>
              <div id="usernameError" class="invalid-feedback ms-2"></div>
            </div>
            <div class="mb-4">
              <label for="password" class="form-label fw-700 text-primary-dark small ms-2 mb-2">Password</label>
              <div class="position-relative">
                <i class="fas fa-key position-absolute start-0 top-50 translate-middle-y ms-3 text-muted"></i>
                <input type="password" class="form-control auth-form-control ps-5" id="password" name="password" placeholder="••••••••" required>
              </div>
              <div id="passwordError" class="invalid-feedback ms-2"></div>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-4 px-2">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="remember" name="remember">
                <label class="form-check-label small fw-600 text-gray" for="remember">Remember me</label>
              </div>
              <a href="{% url 'password_reset' %}" class="small text-primary text-decoration-none fw-700">Forgot?</a>
            </div>
            <div id="loginError" class="alert alert-danger rounded-4 py-3 small d-none" role="alert"></div>
            <button type="submit" class="btn btn-auth-submit w-100" id="loginButton">
              <span id="loginSpinner" class="spinner-border spinner-border-sm d-none me-2" role="status"></span>
              Login to Account
            </button>
          </form>
          
          <div class="text-center mt-5">
            <p class="text-gray small mb-0">Don't have an account yet? 
              <a href="javascript:void(0);" id="showRegister" class="text-primary fw-800 text-decoration-none">Create One</a>
            </p>
          </div>
        </div>

        <!-- Registration Form (hidden by default) -->
        <div id="registerFormContainer" class="d-none auth-transition-container">
          <form id="registerForm" method="POST" action="{% url 'ajax_register' %}">
            {% csrf_token %}
            <div class="mb-4">
              <label for="reg_username" class="form-label fw-700 text-primary-dark small ms-2 mb-2">Username</label>
              <input type="text" class="form-control auth-form-control" id="reg_username" name="username" placeholder="Choose username" required>
              <div id="regUsernameError" class="invalid-feedback ms-2"></div>
            </div>
            <div class="mb-4">
              <label for="reg_email" class="form-label fw-700 text-primary-dark small ms-2 mb-2">Email Address</label>
              <input type="email" class="form-control auth-form-control" id="reg_email" name="email" placeholder="example@email.com" required>
              <div id="regEmailError" class="invalid-feedback ms-2"></div>
            </div>
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label for="reg_password" class="form-label fw-700 text-primary-dark small ms-2 mb-2">Password</label>
                    <input type="password" class="form-control auth-form-control" id="reg_password" name="password" placeholder="••••••••" required>
                    <div id="regPasswordError" class="invalid-feedback ms-2"></div>
                </div>
                <div class="col-md-6">
                    <label for="reg_confirm_password" class="form-label fw-700 text-primary-dark small ms-2 mb-2">Confirm</label>
                    <input type="password" class="form-control auth-form-control" id="reg_confirm_password" name="confirm_password" placeholder="••••••••" required>
                    <div id="regConfirmPasswordError" class="invalid-feedback ms-2"></div>
                </div>
            </div>
            <div id="registerError" class="alert alert-danger rounded-4 py-3 small d-none" role="alert"></div>
            <button type="submit" class="btn btn-auth-submit w-100" id="registerButton">
              <span id="registerSpinner" class="spinner-border spinner-border-sm d-none me-2" role="status"></span>
              Create Account
            </button>
          </form>
          
          <div class="text-center mt-5">
            <p class="text-gray small mb-0">Already have an account? 
              <a href="javascript:void(0);" id="showLogin" class="text-primary fw-800 text-decoration-none">Login Here</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Scripts -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
// Get CSRF token for AJAX requests
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
const csrftoken = getCookie('csrftoken');

// Notification function
let notificationTimeout;
function showNotification(message, isError = false) {
  const notification = document.getElementById('notification');
  if (!notification) return;

  // Clear any existing timer to prevent flashing or staying open
  clearTimeout(notificationTimeout);
  
  notification.className = 'notification';
  if (isError) {
    notification.classList.add('error');
    notification.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>' + message + '</span>';
  } else {
    notification.innerHTML = '<i class="fas fa-check-circle"></i><span>' + message + '</span>';
  }
  
  // Force a tiny reflow to ensure animation triggers if already hidden
  notification.offsetHeight; 
  notification.classList.add('show');
  
  notificationTimeout = setTimeout(() => {
    notification.classList.remove('show');
  }, 2000);
}

// Cart Functionality Elements Removed (Handled by Navbar Dropdown)

// Side Cart Listeners Removed

function openCart() {
  const cartIcon = document.getElementById('cartIconMain');
  if (cartIcon) {
    const dropdown = bootstrap.Dropdown.getOrCreateInstance(cartIcon);
    dropdown.show();
    if (window.fetchMiniCart) window.fetchMiniCart();
  }
}

// Add Item to Cart via AJAX
function addItemToCart(name, price, productId, quantity, variantId, image = "{% static 'Images/download.jpeg' %}") {
  $.ajax({
    url: "{% url 'add_to_cart' %}",
    type: "POST",
    headers: {
      'X-CSRFToken': csrftoken
    },
    data: {
      product_id: productId,
      quantity: quantity,
      variant_id: variantId
    },
    success: function(response) {
      if (response.success) {
        if (window.fetchMiniCart) window.fetchMiniCart();
        updateCartCount();
        openCart();
        showNotification(
          `${name} added to cart! Price: RS ${response.final_price}`
        );
        openCart();
      } else {
        console.error("Error adding item:", response.message);
        showNotification("Error: " + response.message, true);
      }
    },
    error: function(xhr) {
      console.error("Error adding item to cart:", xhr.status, xhr.statusText);
      showNotification("An error occurred while adding the item to the cart.", true);
    }
  });
}

// Side Cart Local Logic Removed

function updateCartCount() {
  fetch("{% url 'cart_count' %}?t=" + new Date().getTime())
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log('Cart count data:', data);
      document.querySelectorAll('.cartCount').forEach(el => {
        el.textContent = data.count || 0;
        el.style.display = (data.count && data.count > 0) ? 'inline-block' : 'none';
      });
    })
    .catch(err => {
      console.error('Error fetching cart count:', err);
      showNotification('Failed to update cart count', true);
    });
}

function updateQuantity(change, inputId) {
  let quantityInput = document.getElementById(inputId);
  let value = parseInt(quantityInput.value);
  if (value + change >= 1) {
    quantityInput.value = value + change;
  }
}

// =========== AUTHENTICATION HANDLING ===========

// Handle unauthenticated add-to-cart buttons (desktop)
document.querySelectorAll(".add-to-cart-unauth").forEach(button => {
  button.addEventListener("click", function () {
    // Show auth modal
    const authModal = new bootstrap.Modal(document.getElementById('authModal'));
    authModal.show();
    
    // Store cart data in modal for later use
    const modal = document.getElementById('authModal');
    modal.dataset.productId = this.dataset.productId;
    modal.dataset.name = this.dataset.name;
    modal.dataset.price = this.dataset.price;
    modal.dataset.quantity = document.getElementById("quantity").value;
    
    // Store variant info
    const variantElement = document.querySelector(".color-option.active");
    if (variantElement) {
      modal.dataset.variantId = variantElement.dataset.variantId;
    }
    
    return false;
  });
});

// Handle authenticated add-to-cart buttons
document.querySelectorAll(".add-to-cart").forEach(button => {
  button.addEventListener("click", function () {
    const name = this.dataset.name;
    const price = parseFloat(this.dataset.price);
    const productId = this.dataset.productId;
    const quantity = parseInt(document.getElementById("quantity").value);
    const variantId = document.querySelector(".color-option.active")?.dataset.variantId || null;
    const image = document.querySelector(".gallery-top .swiper-slide-active img")?.src || "{% static 'Images/download.jpeg' %}";
    
    addItemToCart(name, price, productId, quantity, variantId, image);
  });
});

// Handle unauthenticated order via WhatsApp buttons
document.querySelectorAll(".order-whatsapp-unauth").forEach(button => {
  button.addEventListener("click", function () {
    // Show auth modal
    const authModal = new bootstrap.Modal(document.getElementById('authModal'));
    authModal.show();
    
    // Store WhatsApp order data
    const modal = document.getElementById('authModal');
    modal.dataset.action = 'whatsapp_order';
    modal.dataset.productId = this.dataset.productId;
    modal.dataset.name = this.dataset.name;
    modal.dataset.price = this.dataset.price;
    modal.dataset.quantity = document.getElementById("quantity").value;
    
    return false;
  });
});

// Handle authenticated order via WhatsApp buttons
document.querySelectorAll(".order-whatsapp").forEach(button => {
  button.addEventListener("click", function () {
    const name = this.dataset.name;
    const price = parseFloat(this.dataset.price);
    const productId = this.dataset.productId;
    const quantity = parseInt(document.getElementById("quantity").value);
    const variantId = document.querySelector(".color-option.active")?.dataset.variantId || null;
    const variantImage = document.querySelector(".color-option.active")?.src || null;
    const productSlug = document.querySelector(".share-button")?.dataset.slug;
    const productUrl = `${window.location.origin}/detail/${productSlug}/`;
    
    let message = `Hello, I would like to order the following product:\n`;
    message += `Product: ${name}\n`;
    message += `Price: Rs ${price.toFixed(2)} PKR\n`;
    message += `Quantity: ${quantity}\n`;
    if (variantId && variantImage) {
      message += `Variant: ${variantImage}\n`;
    }
    message += `Product Link: ${productUrl}\n`;
    message += ``;

    const whatsappNumber = '+923104505008';
    const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');

    // Track the WhatsApp order action
    fetch(`/track-whatsapp-order/${productId}/`, {
      method: 'POST',
      headers: {
        'X-CSRFToken': csrftoken,
        'Content-Type': 'application/json'
      },
      credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
      console.log('WhatsApp order tracked:', data);
      showNotification('Order request sent via WhatsApp!');
    })
    .catch(error => {
      console.error('Error tracking WhatsApp order:', error);
      showNotification('Order request sent, but tracking failed.', true);
    });
  });
});

// Handle unauthenticated like buttons
document.querySelectorAll(".like-button-unauth").forEach(button => {
  button.addEventListener('click', function() {
    // Show auth modal
    const authModal = new bootstrap.Modal(document.getElementById('authModal'));
    authModal.show();
    
    // Store like data
    const modal = document.getElementById('authModal');
    modal.dataset.action = 'like';
    modal.dataset.productId = this.dataset.productId;
    
    return false;
  });
});

// Handle authenticated like buttons
document.querySelectorAll('.like-button').forEach(button => {
  button.addEventListener('click', function() {
    const productId = this.dataset.productId;
    const isLiked = this.dataset.liked === 'true';
    const likeText = this.querySelector('.like-text');
    const likeCount = this.querySelector('.like-count');
    
    fetch(`/toggle-like/${productId}/`, {
      method: 'POST',
      headers: {
        'X-CSRFToken': csrftoken,
        'Content-Type': 'application/json'
      },
      credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
      if (data.liked) {
        this.dataset.liked = 'true';
        likeText.textContent = 'Unlike';
        this.classList.add('liked');
      } else {
        this.dataset.liked = 'false';
        likeText.textContent = 'Like';
        this.classList.remove('liked');
      }
      if (likeCount) {
        likeCount.textContent = data.count;
      }
      showNotification(data.liked ? 'Added to favorites' : 'Removed from favorites');
    })
    .catch(error => {
      console.error('Error:', error);
      showNotification('An error occurred while liking the product.', true);
    });
  });
});

// =========== MOBILE BUTTON HANDLING ===========

// Mobile add-to-cart buttons
document.querySelectorAll('#end .add-to-cart').forEach(button => {
  button.addEventListener('click', function () {
    const name = this.dataset.name;
    const price = parseFloat(this.dataset.price);
    const productId = this.dataset.productId;
    const quantity = parseInt(document.getElementById("quantity").value);
    const variantId = document.querySelector(".color-option.active")?.dataset.variantId || null;
    const image = document.querySelector(".gallery-top .swiper-slide-active img")?.src || "{% static 'Images/download.jpeg' %}";
    
    addItemToCart(name, price, productId, quantity, variantId, image);
  });
});

// Mobile unauthenticated add-to-cart buttons
document.querySelectorAll('#end .add-to-cart-unauth').forEach(button => {
  button.addEventListener("click", function () {
    // Show auth modal
    const authModal = new bootstrap.Modal(document.getElementById('authModal'));
    authModal.show();
    
    // Store cart data in modal for later use
    const modal = document.getElementById('authModal');
    modal.dataset.productId = this.dataset.productId;
    modal.dataset.name = this.dataset.name;
    modal.dataset.price = this.dataset.price;
    modal.dataset.quantity = document.getElementById("quantity").value;
    
    // Store variant info
    const variantElement = document.querySelector(".color-option.active");
    if (variantElement) {
      modal.dataset.variantId = variantElement.dataset.variantId;
    }
    
    return false;
  });
});

// =========== MODAL FORM HANDLING ===========

// Handle login form submission
document.getElementById('loginForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const formData = new FormData(this);
  const loginButton = document.getElementById('loginButton');
  const loginSpinner = document.getElementById('loginSpinner');
  
  // Show loading
  loginButton.disabled = true;
  loginSpinner.classList.remove('d-none');
  
  // Clear previous errors
  document.getElementById('loginError').classList.add('d-none');
  document.querySelectorAll('#loginForm input').forEach(input => {
    input.classList.remove('is-invalid');
  });
  
  console.log('Sending login request to:', this.action);
  console.log('Form data:', Object.fromEntries(formData));
  
  fetch(this.action, {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRFToken': csrftoken
    },
    credentials: 'same-origin' // Important: include cookies
  })
  .then(response => {
    console.log('Login response status:', response.status);
    console.log('Login response headers:', response.headers);
    
    // First, get the response text to see what's actually returned
    return response.text().then(text => {
      console.log('Login response text:', text);
      
      // Try to parse as JSON
      try {
        return JSON.parse(text);
      } catch (error) {
        console.error('Failed to parse JSON:', error);
        console.error('Raw response:', text);
        throw new Error('Server returned invalid JSON: ' + text.substring(0, 100));
      }
    });
  })
  .then(data => {
    console.log('Login parsed data:', data);
    
    if (data.success) {
      // Login successful
      showNotification('Login successful!');
      
      const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
      const modal = document.getElementById('authModal');
      
      // Get stored data from modal
      const productId = modal.dataset.productId;
      const name = modal.dataset.name;
      const price = parseFloat(modal.dataset.price);
      const quantity = parseInt(modal.dataset.quantity || document.getElementById("quantity").value);
      const variantId = modal.dataset.variantId || document.querySelector(".color-option.active")?.dataset.variantId || null;
      const action = modal.dataset.action || 'add_to_cart';
      
      // Close modal
      authModal.hide();
      
      // Wait for session to be fully established and page to update
      setTimeout(() => {
        // Refresh the page to update authentication state
        window.location.reload();
        
        // After reload, the authenticated user can add to cart
        // Store the cart action in sessionStorage to be executed after reload
        if (action === 'add_to_cart') {
          sessionStorage.setItem('pendingCartAction', JSON.stringify({
            productId: productId,
            name: name,
            price: price,
            quantity: quantity,
            variantId: variantId,
            action: 'add_to_cart'
          }));
        } else if (action === 'whatsapp_order') {
          sessionStorage.setItem('pendingCartAction', JSON.stringify({
            productId: productId,
            name: name,
            price: price,
            quantity: quantity,
            variantId: variantId,
            action: 'whatsapp_order'
          }));
        }
      }, 1000);
      
    } else {
      // Show errors
      const loginError = document.getElementById('loginError');
      loginError.textContent = data.message || 'Login failed';
      loginError.classList.remove('d-none');
      
      // Show field-specific errors
      if (data.errors) {
        Object.keys(data.errors).forEach(field => {
          const input = document.getElementById(field);
          const errorDiv = document.getElementById(field + 'Error');
          if (input && errorDiv) {
            input.classList.add('is-invalid');
            errorDiv.textContent = data.errors[field];
          }
        });
      }
    }
  })
  .catch(error => {
    console.error('Login fetch error:', error);
    const loginError = document.getElementById('loginError');
    loginError.textContent = 'Error: ' + error.message;
    loginError.classList.remove('d-none');
  })
  .finally(() => {
    loginButton.disabled = false;
    loginSpinner.classList.add('d-none');
  });
});

// Handle registration form submission
document.getElementById('registerForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const formData = new FormData(this);
  const registerButton = document.getElementById('registerButton');
  const registerSpinner = document.getElementById('registerSpinner');
  
  // Show loading
  registerButton.disabled = true;
  registerSpinner.classList.remove('d-none');
  
  // Clear previous errors
  document.getElementById('registerError').classList.add('d-none');
  document.querySelectorAll('#registerForm input').forEach(input => {
    input.classList.remove('is-invalid');
  });
  
  console.log('Sending register request to:', this.action);
  console.log('Form data:', Object.fromEntries(formData));
  
  fetch(this.action, {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRFToken': csrftoken
    },
    credentials: 'same-origin'
  })
  .then(response => {
    console.log('Register response status:', response.status);
    console.log('Register response headers:', response.headers);
    
    // First, get the response text to see what's actually returned
    return response.text().then(text => {
      console.log('Register response text:', text);
      
      // Try to parse as JSON
      try {
        return JSON.parse(text);
      } catch (error) {
        console.error('Failed to parse JSON:', error);
        console.error('Raw response:', text);
        throw new Error('Server returned invalid JSON: ' + text.substring(0, 100));
      }
    });
  })
  .then(data => {
    console.log('Register parsed data:', data);
    
    if (data.success) {
      // Registration successful - auto login
      showNotification('Registration successful! Logging you in...');
      
      // Auto login with the same credentials
      const username = document.getElementById('reg_username').value;
      const password = document.getElementById('reg_password').value;
      
      const loginFormData = new FormData();
      loginFormData.append('username', username);
      loginFormData.append('password', password);
      loginFormData.append('csrfmiddlewaretoken', csrftoken);
      
      return fetch("{% url 'ajax_login' %}?next={{ request.path }}", {
        method: 'POST',
        body: loginFormData,
        headers: {
          'X-CSRFToken': csrftoken
        },
        credentials: 'same-origin'
      })
      .then(response => response.json())
      .then(loginData => {
        if (loginData.success) {
          const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
          const modal = document.getElementById('authModal');
          
          // Get stored data from modal
          const productId = modal.dataset.productId;
          const name = modal.dataset.name;
          const price = parseFloat(modal.dataset.price);
          const quantity = parseInt(modal.dataset.quantity || document.getElementById("quantity").value);
          const variantId = modal.dataset.variantId || document.querySelector(".color-option.active")?.dataset.variantId || null;
          const action = modal.dataset.action || 'add_to_cart';
          
          // Close modal
          authModal.hide();
          
          // Wait for session to be fully established and page to update
          setTimeout(() => {
            // Refresh the page to update authentication state
            window.location.reload();
            
            // After reload, the authenticated user can add to cart
            // Store the cart action in sessionStorage to be executed after reload
            if (action === 'add_to_cart') {
              sessionStorage.setItem('pendingCartAction', JSON.stringify({
                productId: productId,
                name: name,
                price: price,
                quantity: quantity,
                variantId: variantId,
                action: 'add_to_cart'
              }));
            } else if (action === 'whatsapp_order') {
              sessionStorage.setItem('pendingCartAction', JSON.stringify({
                productId: productId,
                name: name,
                price: price,
                quantity: quantity,
                variantId: variantId,
                action: 'whatsapp_order'
              }));
            }
          }, 1000);
        } else {
          throw new Error('Auto-login failed after registration');
        }
      });
    } else {
      // Show errors
      const registerError = document.getElementById('registerError');
      registerError.textContent = data.message || 'Registration failed';
      registerError.classList.remove('d-none');
      
      // Show field-specific errors
      if (data.errors) {
        Object.keys(data.errors).forEach(field => {
          const input = document.getElementById('reg_' + field);
          const errorDiv = document.getElementById('reg' + field.charAt(0).toUpperCase() + field.slice(1) + 'Error');
          if (input && errorDiv) {
            input.classList.add('is-invalid');
            errorDiv.textContent = data.errors[field];
          }
        });
      }
    }
  })
  .catch(error => {
    console.error('Register fetch error:', error);
    const registerError = document.getElementById('registerError');
    registerError.textContent = 'Error: ' + error.message;
    registerError.classList.remove('d-none');
  })
  .finally(() => {
    registerButton.disabled = false;
    registerSpinner.classList.add('d-none');
  });
});

// Check for pending cart actions after page load
document.addEventListener('DOMContentLoaded', function() {
  // Check if there's a pending cart action from login/registration
  const pendingAction = sessionStorage.getItem('pendingCartAction');
  if (pendingAction) {
    const actionData = JSON.parse(pendingAction);
    sessionStorage.removeItem('pendingCartAction');
    
    // Wait a bit more to ensure page is fully loaded
    setTimeout(() => {
      if (actionData.action === 'add_to_cart') {
        const image = document.querySelector(".gallery-top .swiper-slide-active img")?.src || "{% static 'Images/download.jpeg' %}";
        addItemToCart(actionData.name, actionData.price, actionData.productId, 
                     actionData.quantity, actionData.variantId, image);
      } else if (actionData.action === 'whatsapp_order') {
        const variantImage = document.querySelector(".color-option.active")?.src || null;
        const productUrl = `${window.location.origin}/products/${actionData.productId}/`;
        
        let message = `Hello, I would like to order the following product:\n`;
        message += `Product: ${actionData.name}\n`;
        message += `Price: Rs ${actionData.price.toFixed(2)} PKR\n`;
        message += `Quantity: ${actionData.quantity}\n`;
        if (actionData.variantId && variantImage) {
          message += `Variant: ${variantImage}\n`;
        }
        message += `Product Link: ${productUrl}\n`;
        message += ``;

        const whatsappNumber = '+923104505008';
        const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');

        // Track the WhatsApp order action
        fetch(`/track-whatsapp-order/${actionData.productId}/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json'
          },
          credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
          console.log('WhatsApp order tracked:', data);
          showNotification('Order request sent via WhatsApp!');
        })
        .catch(error => {
          console.error('Error tracking WhatsApp order:', error);
          showNotification('Order request sent, but tracking failed.', true);
        });
      }
    }, 500);
  }
});

// Toggle between login and register forms
document.getElementById('showRegister').addEventListener('click', function() {
  document.getElementById('loginFormContainer').classList.add('d-none');
  document.getElementById('registerFormContainer').classList.remove('d-none');
  
  // Update titles
  document.getElementById('authModalTitle').textContent = 'Create Account';
  document.getElementById('authModalSubtitle').textContent = 'Join our community today';
  
  // Clear any existing errors
  document.getElementById('loginError').classList.add('d-none');
  document.querySelectorAll('#loginForm input').forEach(input => {
    input.classList.remove('is-invalid');
  });
});

document.getElementById('showLogin').addEventListener('click', function() {
  document.getElementById('registerFormContainer').classList.add('d-none');
  document.getElementById('loginFormContainer').classList.remove('d-none');
  
  // Update titles
  document.getElementById('authModalTitle').textContent = 'Welcome Back';
  document.getElementById('authModalSubtitle').textContent = 'Please login to continue';
  
  // Clear any existing errors
  document.getElementById('registerError').classList.add('d-none');
  document.querySelectorAll('#registerForm input').forEach(input => {
    input.classList.remove('is-invalid');
  });
});

// Clear modal data when closed
document.getElementById('authModal').addEventListener('hidden.bs.modal', function() {
  delete this.dataset.productId;
  delete this.dataset.name;
  delete this.dataset.price;
  delete this.dataset.quantity;
  delete this.dataset.variantId;
  delete this.dataset.action;
  
  // Reset forms
  document.getElementById('loginForm').reset();
  document.getElementById('registerForm').reset();
  
  // Hide errors
  document.getElementById('loginError').classList.add('d-none');
  document.getElementById('registerError').classList.add('d-none');
  
  // Remove invalid classes
  document.querySelectorAll('#loginForm input, #registerForm input').forEach(input => {
    input.classList.remove('is-invalid');
  });
  
  // Show login form by default
  document.getElementById('registerFormContainer').classList.add('d-none');
  document.getElementById('loginFormContainer').classList.remove('d-none');
  document.getElementById('authModalTitle').textContent = 'Welcome Back';
  document.getElementById('authModalSubtitle').textContent = 'Please login to continue';
});

// =========== OTHER FUNCTIONALITY ===========

// Share functionality
const shareModal = document.getElementById('shareModal');
const shareButtons = document.querySelectorAll('.share-button');
const closeShare = document.querySelector('.close-share');
let currentProductId = null;
let currentProductSlug = null;
 
shareButtons.forEach(button => {
  button.addEventListener('click', function() {
    currentProductId = this.dataset.productId;
    currentProductSlug = this.dataset.slug;
    if (shareModal) {
      shareModal.classList.add("d-flex", "justify-content-center", "align-items-center");
    }
  });
});

if (closeShare) {
  closeShare.addEventListener('click', function() {
    shareModal.classList.remove("d-flex", "justify-content-center", "align-items-center");
  });
}

// Review Modal Logic
const reviewModal = document.getElementById('reviewModal');
const openReviewBtn = document.querySelector('.open-review-modal');
const closeReview = document.querySelector('.close-review');

if (openReviewBtn) {
  openReviewBtn.addEventListener('click', function() {
    if (reviewModal) {
      reviewModal.classList.add("d-flex", "justify-content-center", "align-items-center");
    }
  });
}

if (closeReview) {
  closeReview.addEventListener('click', function() {
    reviewModal.classList.remove("d-flex", "justify-content-center", "align-items-center");
  });
}

window.addEventListener('click', function(event) {
  if (event.target === shareModal) {
    shareModal.classList.remove("d-flex", "justify-content-center", "align-items-center");
  }
  if (event.target === reviewModal) {
    reviewModal.classList.remove("d-flex", "justify-content-center", "align-items-center");
  }
});

document.querySelectorAll('.share-option').forEach(option => {
  option.addEventListener('click', function() {
    const shareType = this.dataset.type;
    const productUrl = `${window.location.origin}/detail/${currentProductSlug}/`;
    const name = document.querySelector('.add-to-cart')?.dataset.name || document.querySelector('.add-to-cart-unauth')?.dataset.name;
    const price = parseFloat(document.querySelector('.add-to-cart')?.dataset.price || document.querySelector('.add-to-cart-unauth')?.dataset.price);
    const quantity = parseInt(document.getElementById("quantity").value);
    const variantId = document.querySelector(".color-option.active")?.dataset.variantId || null;
    const variantImage = document.querySelector(".color-option.active")?.src || null;
    
    if (shareType === 'order-whatsapp') {
      // (Order via WhatsApp logic remains same)
      let message = `Hello, I would like to order the following product:\n`;
      message += `Product: ${name}\n`;
      message += `Price: Rs ${price.toFixed(2)} PKR\n`;
      message += `Quantity: ${quantity}\n`;
      if (variantId && variantImage) {
        message += `Variant: ${variantImage}\n`;
      }
      message += `Product Link: ${productUrl}\n`;
      message += `Please provide further details to complete the order.`;

      const whatsappNumber = '+923104505008';
      const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');

      // Track WhatsApp order action
      fetch(`/track-whatsapp-order/${currentProductId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrftoken,
          'Content-Type': 'application/json'
        },
        credentials: 'same-origin'
      })
      .then(response => response.json())
      .then(data => {
        console.log('WhatsApp order tracked:', data);
        showNotification('Order request sent via WhatsApp!');
      })
      .catch(error => {
        console.error('Error tracking WhatsApp order:', error);
        showNotification('Order request sent, but tracking failed.', true);
      });
    } else {
      switch(shareType) {
        case 'facebook':
          window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(productUrl)}`, '_blank');
          break;
        case 'twitter':
          window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(productUrl)}`, '_blank');
          break;
        case 'whatsapp':
          window.open(`https://wa.me/?text=${encodeURIComponent(`Check out this product: ${productUrl}`)}`, '_blank');
          break;
        case 'link':
          navigator.clipboard.writeText(productUrl)
            .then(() => showNotification('Link copied to clipboard!'))
            .catch(err => {
              console.error('Failed to copy link:', err);
              showNotification('Failed to copy link', true);
            });
          break;
      }

      fetch(`/share-product/${currentProductId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrftoken,
          'Content-Type': 'application/json'
        },
        credentials: 'same-origin'
      })
      .then(response => response.json())
      .then(data => {
        console.log('Share tracked:', data);
      })
      .catch(error => {
        console.error('Error tracking share:', error);
      });
    }
    
    shareModal.classList.remove("d-flex", "justify-content-center", "align-items-center");
  });
});

// Review form submission
document.getElementById('reviewForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  
  fetch(this.action, {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRFToken': csrftoken
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      showNotification('Review submitted successfully!');
      setTimeout(() => {
        window.location.reload();
      }, 1500);
    } else {
      showNotification('Error: ' + data.message, true);
    }
  })
  .catch(error => {
    console.error('Error:', error);
    showNotification('An error occurred while submitting the review', true);
  });
});

// Function to initialize Swiper based on screen size
function initSwipers() {
  try {
    let isLargeScreen = window.matchMedia("(min-width: 768px)").matches;

    if (window.galleryThumbs) window.galleryThumbs.destroy(true, true);
    if (window.galleryTop) window.galleryTop.destroy(true, true);

    window.galleryThumbs = new Swiper(".gallery-thumbs", {
      spaceBetween: 5,
      slidesPerView: 3,
      watchSlidesProgress: true,
      direction: isLargeScreen ? "vertical" : "horizontal",
      on: {
        init: function () {
          console.log("Thumbs Swiper initialized");
        }
      }
    });

    window.galleryTop = new Swiper(".gallery-top", {
      spaceBetween: 5,
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      thumbs: {
        swiper: window.galleryThumbs,
      },
      on: {
        init: function () {
          console.log("Main Swiper initialized");
        },
        slideChange: function () {
          let activeSlide = document.querySelector(".gallery-top .swiper-slide-active img");
          if (!activeSlide) return;
          
          let newPrice = activeSlide.getAttribute("data-price");
          if (newPrice && document.getElementById("priceDisplay")) {
            document.getElementById("priceDisplay").innerText = `Rs ${newPrice}`;
          }

          // Sync variant chips if the slide corresponds to one
          let slideIndex = this.activeIndex;
          document.querySelectorAll('.color-option').forEach(chip => {
            if (parseInt(chip.getAttribute('data-slide-index')) === slideIndex) {
               document.querySelectorAll('.color-option').forEach(c => c.classList.remove('active'));
               chip.classList.add('active');
            }
          });
        }
      }
    });

    document.querySelectorAll(".gallery-thumbs .swiper-slide").forEach((thumbnail, index) => {
      thumbnail.addEventListener("click", function () {
        console.log("Thumbnail clicked:", index);
        window.galleryTop.slideTo(index);
      });
    });

    return { galleryThumbs: window.galleryThumbs, galleryTop: window.galleryTop };
  } catch (error) {
    console.error("Error initializing Swiper:", error);
    showNotification("Failed to initialize image gallery", true);
  }
}

// Initialize Swipers on DOM load
document.addEventListener('DOMContentLoaded', function() {
  initSwipers();
  fetchCartItems();
  updateCartCount();
  
  // Initialize Bootstrap tooltips if needed
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
});

// Reinitialize Swiper on resize
window.addEventListener("resize", function () {
  initSwipers();
});

// Color option selection
document.querySelectorAll('.color-option').forEach((img) => {
  img.addEventListener('click', function () {
    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
    this.classList.add('active');
    let selectedImageSrc = this.getAttribute('src');
    let newPrice = this.getAttribute('data-price');
    let slideIndex = parseInt(this.getAttribute('data-slide-index'));
    let mainSlider = document.querySelector('.gallery-top .swiper-slide-active img');
    if (mainSlider) {
      mainSlider.src = selectedImageSrc;
      mainSlider.setAttribute('data-price', newPrice);
    }
    if (newPrice && document.getElementById("priceDisplay")) {
      document.getElementById("priceDisplay").innerText = `Rs ${newPrice}`;
    }
    window.galleryTop.slideTo(slideIndex);
  });
});

// Initialize EasyZoom
var $easyzoom = $('.easyzoom').easyZoom();

// Refresh cart count periodically
setInterval(updateCartCount, 10000);
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/easyzoom/2.5.2/easyzoom.min.js"></script>
</body>
</html>